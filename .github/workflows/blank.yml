name: CI

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

  workflow_dispatch:

jobs:
  generate:
    runs-on: windows-latest

    steps:
      - uses: actions/checkout@v2
        with:
          repository: 'P3-DAT3-03/Flea'
      - name: Setup .NET
        uses: actions/setup-dotnet@v1
        with:
          dotnet-version: 5.0.x
      - name: Setup DocFx
        run: |
          nuget install docfx.console -Version 2.58.9
          mkdir .\docfx.console.2.58.9\tools\Plugins
          nuget install rest.tagpage -OutputDirectory .\docfx.console.2.58.9\tools\Plugins
          dir
      - name: Generate DocFx Data
        run: |
          .\docfx.console.2.58.9\tools\docfx init -q
          mv ./Flea/* ./docfx_project/src
          mv ./api_spec.yaml ./docfx_project/src
          cd ./docfx_project
          .\..\docfx.console.2.58.9\tools\docfx metadata
      - name: Generate Documentation
        run: |
          dir
          .\..\docfx.console.2.58.9\tools\docfx docfx_project/docfx.json -t default,<output>/rest.tagpage.<version>/content
      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: D:\a\Flea\Flea\docfx_project\_site
          destination_dir: DOC
